var express=require("express"),router=express.Router(),request=require("request");router.param("_id",function(e,s,r,t){console.log("CALLED ONLY ONCE"+t),r()}),router.get("/",function(){}),router.get("/login",function(e,s){s.render("login")}),router.post("/login",function(e,s){var r=require("../serverConfig/server/wmsServerHost.json"),t=e.body.username+"/"+e.body.password;request({method:"GET",json:!0,url:r.url+t,headers:{"Content-Type":"application/json"}},function(r,t,o){if(r||200!=t.statusCode)return s.send({status:500,message:"服务器未响应"});var n=require("../serverConfig/statusConfig.js"),u=n[o.status];switch(o.status){case 1:var a=o.rmsUser;return a.loginPassword=null,delete a.loginPassword,e.session.user=a,console.log("用户:	"+a.name+"	登录成功"),s.send("undefined"!=typeof e.body.originalUrl?{status:n,url:e.body.originalUrl}:{status:n,url:"/"});case 0:case 2:case 3:return s.send({status:n,message:u});default:return s.send({status:500,message:"服务器未响应"})}})}),router.get("/logout",function(e,s){e.session.destroy(),s.redirect("/users/login")}),module.exports=router;