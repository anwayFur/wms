<div id="aa">
    <plan :observer="true"
          :warehouse_id="1"></plan>
</div>
<style>
    .clearfix:after {
        content: " ";
        display: block;
        height: 0;
        clear: both;
    }

    /*IE/7/6*/
    .clearfix {
        *zoom: 1;
    }

    #plan ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    #plan li, #plan .sign .sign__block {
        float: left;
        width: 50px;
        height: 50px;
        margin: 3px;
        border: 1px solid #bbb;
        color: #fff;
        font-size: 12px;
        line-height: 50px;
        text-align: center;
        position: relative;
        border-radius: 10px;
    }

    #plan .aisle {
        background-color: #bbb;
        border-radius: 0;
        border: 1px solid #fff;
    }

    #plan .aisle:before {
        content: ' ';
        position: absolute;
        width: 58px;
        height: 58px;
        left: -3px;
        top: -4px;
        background-color: #ccc;
        z-index: 3;
    }

    #plan .undefined {
        background-color: #ccc;
    }

    #plan .storageArea {
        background-color: #7ED321;
    }

    #plan .sortingArea {
        background-color: #47D0B2;
    }

    #plan .temporaryStorageArea {
        background-color: #F6A623;
    }

    #plan .unqualifiedArea {
        background-color: #FF5066;
    }

    #plan .selectedState {
        border: 2px solid #BD0FE1 !important;
        margin: 2px !important;
    }

    #plan .inner {
        margin: 0 20px;
    }

    #tag {
        width: 100%;
        overflow: scroll;
    }

    #plan .checkList {

    }

    #plan .btnGroup {

    }

    #plan .btn {
        display: inline-block;
        border: 1px solid #999999;
        border-radius: 2px;
        width: 120px;
        height: 30px;
        color: #fff;
    }

    #plan p {
        margin: 0;
    }

    #plan .signGroup {
        height: 44px;
        margin-top: 16px;
        font-size: 16px;
        color: #333333;
    }

    #plan .sign {
        margin-right: 10px;
        display: inline-block;
        float: left;
    }

    #plan .sign .sign__block {
        width: 20px;
        height: 20px;
        border-radius: 2px;
    }

    #plan .sign .sign__block:before {
        display: none;
    }

    #plan .sign .sign__label {
        float: left;
        margin-top: 3px;
        margin-left: 4px;
    }

    #plan .HouseStructureGroup {

    }

    #plan .HouseStructureGroup .HouseStructure {
        float: left;
        width: 48%;
    }

    #plan .HouseStructureGroup .HouseStructure .el-textarea__inner {
        height: 60px;
        background: #FFFFFF;
        border: 1px solid #CCCCCC;
        border-radius: 2px;
    }

    #plan .HouseStructureGroup .HouseStructure__label {
        float: left;
        display: block;
        width: 47%;
        height: 58px;
        margin-left: 2%;
        background: #FCEFB3;
        border: 1px solid #CCCCCC;
        border-radius: 2px;
        padding: 0 1%;
    }

    #plan .HouseStructureGroup {
        margin-top: 30px;
    }

    #plan .btnGroup .el-row {
        margin: 10px 0;
    }


</style>
<script>
    /*<prod>*/
    console.log('线上版本');
    /*</prod>*/

    Vue.component('plan-block', {
        render: function (h) {
            // create kebabCase id
            var e = this.element;
            var click = this.clc;
            var dClick = this.dclc;

            return h('li', {
                "class": {
                    selectedState: e.select,
                    aisle: e.statusColor[0],
                    undefined: e.statusColor[1],
                    storageArea: e.statusColor[2],
                    sortingArea: e.statusColor[3],
                    temporaryStorageArea: e.statusColor[4],
                    unqualifiedArea: e.statusColor[5]
                },
                style: {
                    color: this.kuQuColor(e.id[0])
                },
                attrs: {
                    row: e.row,
                    col: e.col,
                    status: e.status
                },
                on: {
                    click: function () {
                        if (e.id == -1)return;
                        click(e.click());
                    },
                    dblclick: function () {
                        if (e.id == -1)return;
                        dClick(e.click());
                    }
                }
            }, e.id)
        },
        props: {
            element: {
                type: Object,
                required: true
            },
            clc: '',
            dclc: ''
        },
        methods: {
            kuQuColor: function (kuQu) {
                // 适配颜色 在 http://www.bootcss.com/p/websafecolors/ 中挑选26种颜色，最好这些颜色还得兼容咱们的五种区域色 imzhangxing
                // 待测试
                switch (kuQu) {
                    case 'A':
                        return '#000099';
                    case 'B':
                        return '#FFFFCC';
                    case 'C':
                        return '#990033';
                    case 'D':
                        return '#660066';
                    case 'E':
                        return '#666600';
                    case 'F':
                        return '#003300';
                    case 'G':
                        return '#006666';
                    case 'H':
                        return '#990066';
                    case 'I':
                        return '#00CCFF';
                    case 'J':
                        return '#3300FF';
                    case 'K':
                        return '#990066';
                    case 'L':
                        return '#330033';
                    case 'M':
                        return '#000033';
                    case 'N':
                        return '#000000';
                    case 'O':
                        return '#003333';
                    case 'P':
                        return '#00FF66';
                    case 'Q':
                        return '#330000';
                    case 'R':
                        return '#333300';
                    case 'S':
                        return '#660000';
                    case 'T':
                        return '#666633';
                    case 'U':
                        return '#990000';
                    case 'V':
                        return '#996666';
                    case 'W':
                        return '#999966';
                    case 'X':
                        return '#CC0000';
                    case 'Y':
                        return '#FF9900';
                    case 'Z':
                        return '#FFFFFF';
                    default:
                        return '#000'
                }
            }
        }
    });

    Vue.component('plan', {
        template: '\
    <div id="plan">\
        <div class="inner">\
        <div class="HouseStructureGroup clearfix" v-show="HouseStructure" v-if="!observer">\
        <el-input type="textarea" v-model="desc" class="HouseStructure"></el-input>\
        <div class="HouseStructure__label">\
        <p>库区代码结构, 可点击右侧图标显示！</p>\
    </div>\
    </div>\
    <div class="signGroup" v-if="!observer">\
        <div class="sign"><span class="sign__block undefined"></span><span class="sign__label">未定义</span></div>\
        <div class="sign"><span class="sign__block storageArea"></span><span class="sign__label">存储区</span></div>\
        <div class="sign"><span class="sign__block sortingArea"></span><span class="sign__label">分拣区</span></div>\
        <div class="sign"><span class="sign__block temporaryStorageArea"></span><span class="sign__label">暂存区</span>\
        </div>\
        <div class="sign"><span class="sign__block unqualifiedArea"></span><span class="sign__label">不合格区</span>\
        </div>\
        <div class="sign"><span class="sign__block selectedState"></span><span class="sign__label">选中状态</span></div>\
        <div class="sign"><span class="sign__block aisle"></span><span class="sign__label">过道</span></div>                     \
        </div>\
        <div id="tag" style="max-height:350px;">\
        <ul v-for="a of list" :style="{width:listWidth}" class="clearfix">\
        <plan-block\
    v-for="a1 of a"\
        :clc="eClick"\
    :dclc="eDoubleClick"\
    :element="a1">\
        </plan-block>\
        </ul>\
        </div>\
        <p v-if="!observer">快速选择库区</p>\
        <el-checkbox-group v-model="checkList" @change="checkListChange" class="checkList">\
        <el-checkbox :label="big.id" v-for="big of bigKuQu"></el-checkbox>\
        </el-checkbox-group>\
        <div class="btnGroup" v-if="!observer">\
        <el-row>\
        <el-col :span="4">\
        <button class="btn storageArea" @click="set(2)">设为存储区</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn temporaryStorageArea" @click="set(4)">设为暂存区</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn undefined" @click="set(1)">设为未设定区</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn " @click="">查看所有库区</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn resetSelect" @click="resetSelect">重置选择</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn resetHouse" @click="resetHouse">调整仓库结构</button>\
        </el-col>\
        </el-row>\
        <el-row>\
        <el-col :span="4">\
        <button class="btn sortingArea" @click="set(3)">设为分拣区</button>\
        </el-col>\
        <el-col :span="4">\
        <button class="btn unqualifiedArea" @click="set(5)">设为不合格区</button>\
        </el-col>\
        <el-col :span="4" :offset="8">\
        <button class="btn unqualifiedArea" @click="">保存修改</button>\
        </el-col>\
        </el-row>\
        </div>\
        <el-dialog\
    :title="form.title"\
    @open="dialogOpen"\
    v-model="dialogTableVisible">\
        <el-table :data="form.tableData">\
        <el-table-column property="row" label="row" width="150"></el-table-column>\
        <el-table-column property="col" label="col" width="200"></el-table-column>\
        <el-table-column property="status" label="status"></el-table-column>\
        </el-table>\
        <div id="dialogECharts" style="width: 600px;height:400px;"></div>\
        </el-dialog>\
        </div>\
        </div>\
    ',
        props: {observer: null, warehouse_id: null},
        data: function () {
            return {
                isdb: false,
                desc: '',                        // TODO 平面图 总数据信息 (未解析)
                kuQu: [[]],                      // 库区
                bigKuQu: {},                     // 库区组

                oldKuQu: [],                     // 旧的库区备份
                form: this.new_form(),           // 弹出层 基础数据
                dialogTableVisible: false,       // 弹出层 维护
                dialogECharts: {
                    title: {
                        text: '某站点用户访问来源',
                        subtext: '纯属虚构',
                        x: 'center'
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: "{a} <br/>{b} : {c} ({d}%)"
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left',
                        data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']
                    },
                    series: [
                        {
                            name: '访问来源',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: [
                                {value: 335, name: '直接访问'},
                                {value: 310, name: '邮件营销'},
                                {value: 234, name: '联盟广告'},
                                {value: 135, name: '视频广告'},
                                {value: 1548, name: '搜索引擎'}
                            ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                },            // 弹出层 图表

                checkList: [],                   // 快捷多选 维护
                selected: [],                    // 被选中的库区
                HouseStructure: false            // 库区结构
            };
        },
        computed: {
            list: function () {
                var obj = [[]];
                var kuQu = {};
                var row = 0;
                var rRow = 0;
                var col = 1;
                var step = {};

                var ifAisle = false;

                for (var i = 0; i < this.desc.length; i++) {
                    switch (this.desc[i]) {
                        case ' ':       //过道
                            obj[rRow].push({id: -1, status: 0, statusColor: [true, false, false, false, false, false]});
                            break;
                        case '\n':      //换行
                            rRow++;
                            if (!ifAisle) {

                            } else {
                                row++;
                                ifAisle = false;
                            }
                            col = 1;
                            obj.push([]);
                            break;
                        default:        //仓库
                            ifAisle = true;
                            if (typeof kuQu[this.desc[i]] == 'undefined') {
                                kuQu[this.desc[i]] = {color: '', src: [], id: this.desc[i].toUpperCase()};
                            }
                            step = {
                                row: row,
                                col: col++,
                                statusColor: [false, true, false, false, false, false],
                                status: 1,
//                                id: kuQu[this.desc[i]].id + kuQu[this.desc[i]].src.length,
                                id: kuQu[this.desc[i]].id + (row + 1) + '-' + (col - 1),
//                                id: (row+1) + '-' + (col-1) + '-' + kuQu[this.desc[i]].id
                                click: function () {
                                    return this;
                                },
                                select: false
                            };
                            kuQu[this.desc[i]].src.push(step);                  //库区
                            obj[rRow].push(step);
                    }
                }
                this.bigKuQu = kuQu;
                this.kuQu = obj;

                return obj;
            },           // list所有的储存区域
            listWidth: function () {
                var maxNumber = this.kuQu[0].length;
                for (var i = 1; i < this.kuQu.length; i++) {
                    if (this.kuQu[i].length > maxNumber)
                        maxNumber = this.kuQu[i].length;
                }
                return maxNumber * 58 + 'px';
            }       // 维护最大平面图宽度
        },
        methods: {
            isAisle: function (id) {
                if (id == -1) {

                } else {

                }
            },
            dialogOpen: function () {
                var obj = this;
                Vue.nextTick(function () {
                    var myChart = echarts.init(document.getElementById('dialogECharts'));
                    myChart.setOption(obj.$data.dialogECharts);
                });
            },
            checkListChange: function () {
                this.resetSelectC(this.kuQu);
                this.selected = [];
                for (var b = 0; b < this.checkList.length; b++) {
                    var step = this.checkList[b].toLowerCase();
                    for (var i = 0; i < this.bigKuQu[step].src.length; i++) {
                        this.bigKuQu[step].src[i].select = true;
                        this.selected.push(this.bigKuQu[step].src[i]);
                    }
                }
            },
            selectedKuQu: function (e) {
                e.select = !e.select;
                if (e.select) {
                    this.selected.push(e);
                } else {
                    (function (obj, data) {
                        for (var i = 0; i < data.length; i++) {
                            var temp = data[i];
                            if (!isNaN(obj)) {
                                temp = i;
                            }
                            if (temp == obj) {
                                for (var j = i; j < data.length; j++) {
                                    data[j] = data[j + 1];
                                }
                                data.pop();
                            }
                        }
                    })(e, this.selected);
                }
            },
            resetSelect: function () {
                this.resetSelectC(this.kuQu);
                this.checkList = [];
                this.selected = [];
            },
            set: function (number) {
                //TODO 此处应有检查
                for (var i = 0; i < this.selected.length; i++) {
                    this.selected[i].statusColor[this.selected[i].status] = false;
                    this.selected[i].statusColor[number] = true;
                    this.selected[i].status = number;
                }
                //TODO 此处有应有post请求
                this.resetSelect();
            },
            deleteArea: function () {

            },

            eClick: function (e) {
                var obj = this;
                obj.isdb = false;
                window.setTimeout(function () {
                    if (obj.isdb != false)return;
                    obj.selectedKuQu(e);
                }, 300);
            },      // 单击库区 选中
            eDoubleClick: function (e) {
                //TODO 模拟弹出层 完整版
                this.isdb = true;
                var obj = this;
//                    console.log(e);
                if (this.selected.length < 2) {
                    obj.$data.form.tableData = [e];
                    obj.$data.form.title = e.id;
                } else {
                    obj.$data.form.tableData = this.selected;
                    obj.$data.form.title = '选中区域信息';
                }
                obj.$data.dialogTableVisible = true;
            },// 双击库区 查看详细信息

            resetHouse: function () {
                this.HouseStructure = !this.HouseStructure;
            },
            resetSelectC: function (kuQu) {
                for (var b = 0; b < kuQu.length; b++) {
                    for (var i = 0; i < kuQu[b].length; i++) {
                        kuQu[b][i].select = false;
                    }
                }
            },

            new_form: function () {
                return {
                    title: '查看\tA1-1',
                    tableData: this.new_tableData()
                }
            },

            new_tableData: function () {
                return {
                    row: 0,
                    col: 0,
                    status: 0
                }
            },
            init: function () {
                var obj = this;
                var complie = 0;                                //统计页面是否全部完成
                var end = 1;
                app.$data.fullscreenLoading = true;             //显示加载

                function Loading() {
                    complie++;
                    if (complie >= end) {
                        app.$data.fullscreenLoading = false; //结束加载
                    }
                }

                //------------------------- 加载 kuQu      -----------------------

                (function () {
                    /*<debug>*/
                    url = 'hock/warehouse/id.json';
                    /*</debug>*/

                    /*<prod>*/
                    // TODO 配置 kuQu 获取地址
                    url = 'hock/warehouse/id';
                    /*</prod>*/

                    $.ajax(url, {
                        type: "GET",
                        data: {},
                        error: function () {
                        },
                        success: function (json) {
                            obj.$data.desc = json.desc;
                            setTimeout(function () {
                                (function (json) {
                                    for (var i = 0; i < json.length; i++) {
                                        for (var b = 0; b < json[i].length; b++) {
                                            if (typeof obj.$data.kuQu[i][b] === 'undefined') continue;
                                            obj.$data.kuQu[i][b].row = json[i][b].row;
                                            obj.$data.kuQu[i][b].col = json[i][b].col;
                                            obj.$data.kuQu[i][b].statusColor = json[i][b].statusColor;
                                            obj.$data.kuQu[i][b].status = json[i][b].status;
                                            obj.$data.kuQu[i][b].select = json[i][b].select;
                                        }
                                    }
                                })(json.kuQu);
                                obj.$data.oldKuQu = json.kuQu;
                            }, 0);
                        },
                        complete: function () {
                            Loading();
                        }
                    });
                })();

                //------------------------- 是否启用 观察模式-----------------------
                if (this.observer) obj.$data.observer = true;
            }
        },
        mounted: function () {

            /*<debug>*/
            console.log(this.observer, this.warehouse_id);
            /*</debug>*/
            if(this.warehouse_id) this.init();
        },
        watch: {
            desc: function () {
                var obj = this;
                if (this.$data.oldKuQu.length != 0) {
                    setTimeout(function () {
                        (function (json) {
                            for (var i = 0; i < json.length; i++) {
                                for (var b = 0; b < json[i].length; b++) {
                                    if (typeof obj.$data.kuQu[i][b] === 'undefined') continue;
                                    obj.$data.kuQu[i][b].row = json[i][b].row;
                                    obj.$data.kuQu[i][b].col = json[i][b].col;
                                    obj.$data.kuQu[i][b].statusColor = json[i][b].statusColor;
                                    obj.$data.kuQu[i][b].status = json[i][b].status;
                                    obj.$data.kuQu[i][b].select = json[i][b].select;
                                }
                            }
                        })(obj.$data.oldKuQu);
                    }, 0);
                }
            }
        }
    });

    var vm = new Vue({
        el: '#aa'
    })
</script>